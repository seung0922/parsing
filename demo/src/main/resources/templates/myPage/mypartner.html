<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{fragments/mypageLayout}">
<div class="container" th:replace="fragments/mypageLayout :: mypage-container">
	<div class="mypage-content" layout:fragment="mypage-content">
        <!-- <style>
            #table {display: table; width: 100%;}
            .row {display: table-row;}
            .cell {display: table-cell; padding: 3px; border-bottom: 1px solid #DDD;}
            .col1 {width: 20%;}
            .col2 {width: 20%;}
            .col3 {width: 40%;}
            .col4 {width: 20%;}
        </style> -->

		<!-- css 링크 -->
		<!-- <link rel="stylesheet" th:href="@{/css/css.css}"> -->

		<!-- Bootstrap -->
        <!-- <link th:href="@{/resources/bootstrap/css/bootstrap.css}" rel="stylesheet" type="text/css"/> -->
        <link th:href="@{/resources/image/icon/HalfLife.ico}" rel="shortcuticon">
		
        <!-- 메뉴명 & 설명 -->
        <div>
            <h4>친구 관리</h4>
            <!-- <p>내 친구 목록</p> -->
        </div>

		<!-- 본문 -->
        <div>

            <div>
                <p><b>친구요청 목록</b></p>
                <ul class="list-group list-group-flush" th:each="request : ${requestList}">
                    <li th:if="${request.sender} == ${memberInfo.userid}" class="list-group-item">[[${request.receiver}]] 님께 친구 요청중
                        <button class="btn btn-outline-danger delBtn">취소</button>
                        <input class="friendno" type="hidden" th:value="${request.mateno}">
                        <input class="friendre" type="hidden" th:value="${request.receiver}">
                    </li>
                    <li th:if="${request.sender} != ${memberInfo.userid}" class="list-group-item">[[${request.sender}]] 님께 친구 요청이 왔습니다
                        <button class="btn btn-success" id="acceptBtn" style="color: white;">수락</button>
                        <input type="hidden" th:value="${request.mateno}">
                    </li>
                </ul>
            </div>

            <div>
                <p><b>친구 목록</b></p>
                <ul th:each="friend : ${friendList}">
                    <li>[[${friend.receiver}]]
                        <button class="btn btn-link friendBtn">정보</button>
                        <button class="btn btn-outline-danger delBtn">삭제</button>
                        <input class="friendno" type="hidden" th:value="${friend.mateno}">
                        <input class="friendre" type="hidden" th:value="${friend.receiver}">
                    </li>
                </ul>
            </div>

        </div>

        <!-- 친구 삭제 -->
        <form th:action="@{/mypage/delmate}" method="post" id="delf">
            <input id="delno" name="mateno" type="hidden">
        </form>

        <!-- 친구 수락 -->
        <form th:action="@{/mypage/updatemate}" method="post" id="accf">
            <input id="accno" name="mateno" type="hidden">
        </form>



        <div id="table">
            <div class="row">
            <span class="cell col1">열 1-1</span>
            <span class="cell col2">열 1-2</span>
            <span class="cell col3">열 1-3</span>
            <span class="cell col4">열 1-4</span>
            </div>
            <div class="row">
            <span class="cell col1">열 2-1</span>
            <span class="cell col2">열 2-2</span>
            <span class="cell col3">열 2-3</span>
            <span class="cell col4">열 2-4</span>
            </div>
            </div>
        
	<!-- script -->
	<script>

    var delf = $("#delf");
    var accf = $("#accf");
    
    // 취소 버튼 눌렀을 때
    $(".delBtn").on("click", function() {

        console.log("delete friend.................");

        var mateno = $(this).siblings("input[class=friendno]").val();
        console.log(mateno);

        swal({
            title: "정말 친구를 삭제하시겠습니까?",
            text: "친구를 삭제하면 해당 친구의 정보를 더 이상 볼 수 없습니다.",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                swal("친구를 삭제했습니다.", {
                    icon: "success",
                })
                .then(function() {

                    // 히든폼 value 집어넣고 폼 보낸다
                    $("#delno").val(mateno);

                    delf.submit();
                    
                }); // then 끝
            } else {
                swal("굿 쵸이스-☆★");
            }

        }); // then 끝
    }); // del click 끝


    // 수락 버튼 눌렀을 때
    $("#acceptBtn").on("click", function() {

        var mateno = $(this).siblings("input").val();
        console.log(mateno);

        swal("친구 수락", {
            icon: "success"
        })
        .then(function() {

            // 히든폼 value 집어넣고 폼 보낸다
            $("#accno").val(mateno);

            accf.submit();
        });
    });

    $(".friendBtn").on("click", function() {

        var uid = $(this).siblings("input[class=friendre]").val();

        location.href="/mypage/pdetail?userid=" + uid;
    });

	</script>	 
	</div>	<!-- (mypage-content) fragment close -->
</div>	<!-- (mypage-container) div close -->